---
layout: single
title: "Qdrant 설치(서버)"
categories: etc
tag: [etc]
toc: true
toc_sticky: true
author_profile: false
---

## Docker / docker compose 설치

``` bash
# 필수 패키지
sudo dnf update -y
sudo dnf -y install docker
sudo systemctl enable --now docker
sudo usermod -aG docker ec2-user

# SSH 재접속 후 설치 확인
docker version

# Docker Compose(v2) 설치
sudo mkdir -p /usr/local/lib/docker/cli-plugins/

sudo curl -SL "https://github.com/docker/compose/releases/latest/download/docker-compose-linux-$(uname -m)" \
  -o /usr/local/lib/docker/cli-plugins/docker-compose

sudo chmod +x /usr/local/lib/docker/cli-plugins/docker-compose

docker compose version

#  디렉터리/볼륨 준비(영속화)
sudo mkdir -p /opt/qdrant/storage
sudo chown -R 1000:1000 /opt/qdrant

# docker-compose.yml 생성
sudo mkdir -p /opt/qdrant
sudo tee /opt/qdrant/docker-compose.yml >/dev/null <<'YAML'
services:
  qdrant:
    image: qdrant/qdrant:v1.16.2-unprivileged
    container_name: qdrant
    restart: unless-stopped

    ports:
      - "127.0.0.1:6333:6333"
      - "127.0.0.1:6334:6334"

    volumes:
      - /opt/qdrant/storage:/qdrant/storage
YAML

# 실행
cd /opt/qdrant
docker compose up -d
docker compose ps

# 로그 확인
docker logs -n 50 qdrant

# 동작 확인
curl -s http://127.0.0.1:6333/ | head

# 컬렉션 목록 확인
curl -s http://127.0.0.1:6333/collections | head
```



## Swap 파일 생성

``` bash
# Swap 파일 생성
sudo fallocate -l 2G /swapfile

# 권한 설정
sudo chmod 600 /swapfile

# swap으로 포맷 + 활성화
sudo mkswap /swapfile
sudo swapon /swapfile

# 확인
free -h
swapon --show

# 재부팅 후에도 유지되도록 등록
echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab
```



## Swap 너무 적극적으로 쓰지 않게 조절

``` bash
# 현재 값 확인
cat /proc/sys/vm/swappiness

# swappiness 10으로 설정
echo 'vm.swappiness=10' | sudo tee /etc/sysctl.d/99-swappiness.conf
sudo sysctl -p /etc/sysctl.d/99-swappiness.conf
```











